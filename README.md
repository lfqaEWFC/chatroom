
#  Chatroom (C++ | Epoll | MySQL | Redis)

一个简易的Linux聊天室系统，支持多客户端并发通信、好友管理、群组聊天、文件通知传输、离线消息等功能。

##  项目结构

```
chatroom/
├── cli/             # 客户端代码
├── ser/             # 服务端主程序
├── include/            # 网络套接字封装 
├── define/             # 宏定义、常量配置
├── database/           # 数据库封装类（MySQL + Redis）
├── CMakeLists.txt      # 总工程 CMake 配置
└── ...
```

##  技术栈

- **语言**：C++
- **网络模型**：`epoll` + `多 Reactor 模式`
- **并发模型**：`线程池` + `eventfd` 通知
- **数据库**：
  - `MySQL`：持久化用户、好友、群组、聊天记录等数据
  - `Redis`：缓存离线消息
- **数据协议**：`nlohmann::json` 格式消息通信
- **文件传输**：集成自建 FTP 服务，客户端控制、被动模式连接

## 编译方式

```bash
- 进入chatroom目录
- cmake ..
- make -j
```

会生成：
- `client`：客户端可执行文件
- `server`：chat 服务端可执行文件
- `FTP_serve`：FTP服务端可执行文件

## 运行方式

###  启动服务端

```bash
./server
./FTP_serve
```

### 启动客户端

```bash
./client 服务器ip
```

客户端会自动连接服务端（默认 localhost，支持设置 IP 和端口）。

## 功能概览

| 模块      | 功能                                                             |
|-----------|------------------------------------------------------------------|
| 登录注册  | 用户注册、登录、找回密码（密保）                                 |
| 好友系统  | 添加好友、拉取好友申请、接受/拒绝申请                            |
| 私聊      | 文本消息、离线消息提醒                                           |
| 群聊      | 群管理、群消息、群信息查询                          |
| 文件传输  | 文件消息通知 + FTP 被动接收（传输过程不走主消息通道）            |
| 离线机制  | 使用 Redis 保存离线的消息、系统通知等                      |
| 心跳机制  | FTP_serve 的控制连接负责监测客户端的心跳                                      |
| 粘包处理  | 客户端和服务端均实现 TCP 粘包分离机制                           |

## 数据结构简要说明

### MySQL 表结构示意：

| 表名             | 功能描述                  |
|------------------|---------------------------|
| `user`           | 用户信息              |
| `friendship`         | 好友关系                  |
| `groups`     | 群组信息                  |
| `group_members`   | 群成员表              |
| `private_message`|  私聊历史消息
| `group_message`        | 群聊历史消息                  |
| `group_file`      | 群聊文件信息    |
| `private_file`    | 私聊文件信息  |


## ⚠ 注意事项

- 所有 JSON 消息都有 `request` 字段用于客户端和服务端识别指令
- 客户端通过 `epoll + 子线程recv` 实现异步收消息
- 粘包分离逻辑基于客户端/服务端每个连接独立的缓冲区
- 客户端文件收发需要配合 FTP 子模块（另行编译）
